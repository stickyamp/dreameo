<ion-header>
  <ion-toolbar class="dream-toolbar">
    <ion-title i18n="@@add.dream.title.edit" *ngIf="isEditing">Editar Sueño</ion-title>
    <ion-title i18n="@@add.dream.title.new" *ngIf="!isEditing">Nuevo Sueño</ion-title>
    <ion-buttons slot="start">
      <ion-button (click)="dismiss()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <div class="header-subtitle">
    <span class="date-subtitle">{{ getFormattedDate() }}</span>
  </div>
</ion-header>

<ion-content class="dream-container">
  <div class="dream-form">
    <!-- Title Input -->
    <div class="form-section">
      <ion-item class="dream-input">
        <ion-label position="stacked" i18n="@@add.dream.title.label">Título</ion-label>
        <ion-input
          [(ngModel)]="dreamData.title"
          i18n-placeholder="@@add.dream.title.placeholder" placeholder="Dale un nombre a tu sueño"
          maxlength="100">
        </ion-input>
      </ion-item>
    </div>

    <!-- Description Input -->
    <div class="form-section">
      <ion-item class="dream-input">
        <ion-label position="stacked" i18n="@@add.dream.description.label">Descripción</ion-label>
        <ion-textarea
          [(ngModel)]="dreamData.description"
          i18n-placeholder="@@add.dream.description.placeholder" placeholder="Describe tu sueño..."
          rows="8"
          maxlength="1000">
        </ion-textarea>
      </ion-item>
    </div>

    <!-- Dream Type Selection -->
    <div class="form-section">
      <div class="type-section">
        <h3 class="section-title" i18n="@@add.dream.type.title">Tipo de sueño</h3>
        <p class="section-description" i18n="@@add.dream.type.description">
          ¿Fue un sueño agradable o una pesadilla?
        </p>
        
        <div class="type-buttons">
          <ion-button
            [fill]="dreamData.type === 'good' ? 'solid' : 'outline'"
            [color]="dreamData.type === 'good' ? 'success' : 'medium'"
            (click)="dreamData.type = 'good'"
            class="type-button">
            <ion-icon name="heart" slot="start"></ion-icon>
            <span i18n="@@add.dream.type.good">Sueño bueno</span>
          </ion-button>
          
          <ion-button
            [fill]="dreamData.type === 'bad' ? 'solid' : 'outline'"
            [color]="dreamData.type === 'bad' ? 'danger' : 'medium'"
            (click)="dreamData.type = 'bad'"
            class="type-button">
            <ion-icon name="warning" slot="start"></ion-icon>
            <span i18n="@@add.dream.type.bad">Pesadilla</span>
          </ion-button>
        </div>
      </div>
    </div>

    <!-- Voice Recording Section -->
    <div class="form-section">
      <div class="voice-section">
        <h3 class="section-title" i18n="@@add.dream.voice.title">Grabación de Voz</h3>
        <p class="section-description" i18n="@@add.dream.voice.description">
          Graba tu voz como alternativa o complemento al texto
        </p>
        <div class="recording-controls">
          <ion-button
            *ngIf="!isRecording && !audioPath"
            (click)="startRecording()"
            fill="outline"
            class="record-button">
            <ion-icon name="mic" slot="start"></ion-icon>
            <span i18n="@@add.dream.voice.record">Grabar voz</span>
          </ion-button>

          <ion-button
            *ngIf="isRecording"
            (click)="stopRecording()"
            fill="solid"
            color="danger"
            class="recording-pulse">
            <ion-icon name="stop" slot="start"></ion-icon>
            <span i18n="@@add.dream.voice.stop">Detener grabación</span>
          </ion-button>

          <div *ngIf="audioPath && !isRecording" class="audio-controls">
            <ion-button
              (click)="playAudio()"
              fill="outline"
              [disabled]="isPlayingAudio">
              <ion-icon name="play" slot="start"></ion-icon>
              <span *ngIf="isPlayingAudio" i18n="@@add.dream.voice.playing">Reproduciendo...</span>
              <span *ngIf="!isPlayingAudio" i18n="@@add.dream.voice.play">Reproducir audio</span>
            </ion-button>
            
            <ion-button
              (click)="deleteAudio()"
              fill="clear"
              color="danger">
              <ion-icon name="trash" slot="start"></ion-icon>
              <span i18n="@@add.dream.delete">Eliminar</span>
            </ion-button>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="form-actions">
      <ion-button
        expand="block"
        class="dream-button"
        (click)="saveDream()"
        [disabled]="!canSave()">
        <ion-icon name="save" slot="start"></ion-icon>
        <span *ngIf="isEditing" i18n="@@add.dream.update">Actualizar</span>
        <span *ngIf="!isEditing" i18n="@@add.dream.save">Guardar</span>
      </ion-button>
    </div>
  </div>
</ion-content>
