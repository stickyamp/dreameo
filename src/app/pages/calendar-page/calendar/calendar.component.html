<ion-content
  [scrollEvents]="false"
  scrollY="true"
  [fullscreen]="true"
  class="calendar-container"
>
  <!-- Calendar Section -->
  <div class="calendar-section">
    <!-- Month Navigation -->
    <div class="month-navigation">
      <ion-button fill="clear" class="month-nav-btn" (click)="previousMonth()">
        <ion-icon name="chevron-back" slot="icon-only"></ion-icon>
      </ion-button>
      <h3 class="month-label">{{ getMonthYearLabel() }}</h3>
      <ion-button fill="clear" class="month-nav-btn" (click)="nextMonth()">
        <ion-icon name="chevron-forward" slot="icon-only"></ion-icon>
      </ion-button>
    </div>

    <!-- Calendar Grid -->
    <div class="calendar-grid">
      <!-- Weekday Headers -->
      <div class="weekday-headers">
        <div class="weekday" *ngFor="let day of daysOfWeek">{{ day }}</div>
      </div>

      <!-- Calendar Days -->
      <div class="calendar-days">
        <div
          class="calendar-day"
          *ngFor="let day of calendarDays; trackBy: trackByDay"
          [class.current-month]="day.currentMonth"
          [class.selected]="isSelected(day.date)"
          [class.today]="isToday(day.date)"
          [class.has-dreams]="hasDreams(day.date)"
          (click)="selectDay(day)"
        >
          <span class="day-number">{{ day.day }}</span>
          <span class="dream-indicator" *ngIf="hasDreams(day.date)"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Bloque: Dream Journey Map (Mapa constelación) -->
  <div
    class="dream-map-container"
    style="
      background: var(--color-surface);

      box-shadow: var(--shadow-elevation);
    "
  >
    <div class="dream-map-header">
      {{ "CALENDAR.DREAM_JOURNEY_MAP_TITLE" | translate }}
    </div>
    <div class="dream-constellation-background">
      <svg
        viewBox="0 0 350 130"
        class="dream-constellation-svg"
        preserveAspectRatio="none"
      >
        <!-- Estrellas de fondo pequeñas -->
        <ng-container *ngFor="let s of bgStars">
          <circle
            [attr.cx]="s.x"
            [attr.cy]="s.y"
            [attr.r]="s.r"
            fill="var(--color-accent)"
            opacity="0.4"
          />
        </ng-container>
        
        <!-- Líneas de conexión simples -->
        <polyline
          *ngIf="dreamDayPoints.length > 1"
          [attr.points]="polylineString"
          fill="none"
          stroke="var(--color-accent)"
          stroke-width="1"
          opacity="0.6"
        />
        
        <!-- Estrellas principales de la constelación -->
        <ng-container *ngIf="dreamDayPoints.length > 0">
          <ng-container *ngFor="let pt of dreamDayPoints">
            <g [attr.transform]="'translate(' + (pt.x - 8) + ',' + (pt.y - 8) + ')'">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path 
                  stroke-linecap="round" 
                  stroke-linejoin="round" 
                  d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z" 
                  fill="var(--color-accent)" 
                  stroke="var(--color-accent)" 
                  stroke-width="0.5"
                  opacity="0.9"
                />
              </svg>
            </g>
          </ng-container>
        </ng-container>
      </svg>
    </div>
    <div *ngIf="dreamDayPoints.length === 0" class="constellation-empty-message">
      <span>{{ "CALENDAR.NO_DREAMS_THIS_MONTH" | translate }}</span>
    </div>
  </div>

  <!-- Bloque: Progreso mensual/rango-nivel -->
  <div class="dream-progress-row">
    <!-- Card pequeña (badge) -->
    <div class="progress-badge-card">
      <div class="progress-rank-badge">
        <div class="rank-icon-container">
          <ion-icon name="shield-outline" class="rank-icon-shield"></ion-icon>
          <ion-icon name="moon-outline" class="rank-icon-moon"></ion-icon>
        </div>
        <div class="rank-name-main">{{ currentRankName | translate }}</div>
        <div class="rank-name-sub">{{ "CALENDAR.DREAMER" | translate }}</div>
      </div>
    </div>

    <!-- Card grande (progreso) -->
    <div class="progress-main-card">
      <div class="progress-section-right">
        <div class="progress-title-row">
          <span class="progress-title"
            >{{ "CALENDAR.PROGRESS_TO" | translate }}
            {{ nextRankName | translate }}</span
          >
          <span class="progress-count-text"
            >{{ currentDreamsCount }}/{{ dreamsNeededForNext }}
            {{ "CALENDAR.DREAMS" | translate }}</span
          >
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar-track">
            <div
              class="progress-bar-fill-glow"
              [style.width.%]="progressToNextPercent"
            ></div>
          </div>
        </div>
        <div class="progress-encouragement">
          {{ "CALENDAR.KEEP_GOING" | translate }}
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for dreams list -->
  <div
    id="add-dream-modal"
    #modalOpener="appShowDreamsList"
    appShowDreamsList
  ></div>
</ion-content>
